#!/bin/env ruby

require 'lrjew'

lru_size   = ARGV[0] || 100_000
print_freq = ARGV[1] || 50_000

indexed_stack = IndexedBoundedStack.new(BoundedStack.new(LinkedList.new, lru_size))

lru = Lru.new(indexed_stack)

GC.disable
$stdin.each_with_index do |line, idx|
  lru.include?(line)
  if (idx+1) % print_freq == 0
    puts "#{Time.now}: #{lru.inspect}"
    GC.start
    GC.disable
  end
end
